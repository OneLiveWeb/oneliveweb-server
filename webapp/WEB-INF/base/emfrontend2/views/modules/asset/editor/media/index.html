#set($cdnprefix = $!{mediaarchive.getCatalogSettingValue("cdn_prefix")})
#if(!$cdnprefix )
	#set($cdnprefix = $context.siteRoot )
#end
#set( $originalpath = $mediaarchive.asLinkToOriginal($asset) )
<div id="asset-editor-container" class="h-100">
<h2>[[Media Files]]</h2>
#if($candownload)	
	<a class="btn btn-sm btn-primary" 
	href="#urlencode("$cdnprefix$home/$mediadbappid/services/module/asset/downloads/originals/$originalpath?collectionid=${collectionid}&assetid=$asset.getId()")"
	style="margin-right:5px;"
	title="[[Download]] $asset.name"
	><i class="fas fa-download"></i> [[Download Original]]</a>
#end
<div class="">
#set($mediadbappid=$mediaarchive.getMediaDbId())
#set($type = $mediaarchive.getMediaRenderType($asset.fileformat))
#set($newpreset = $context.findValue("newpreset"))
#set($type =$mediaarchive.getMediaRenderType($asset.fileformat))
#set($results = $conversionUtil.getActivePresetList($catalogid,$type) )
$context.putPageValue("results", $results)

#set($currentpreset = $context.getRequestParameter("currentpreset"))
	
	
	
##	#if($caneditasset)
##	<a class="btn btn-sm btn-secondary ajax" targetdivinner="asset-editor-container" data-oemaxlevel="1" 
##	   href="$home$apphome/views/modules/asset/editor/media/croppreview.html?assetid=$asset.id&presetid=largeimage&noaspect=true&savetoall=true">[[New Crop]]</a>
##
##	#end

		<div class="media-presets">
		#foreach ($result in $results)
			
			$context.putPageValue("presetdata", $result)
			#set($presetdata = $result)
			
			#set($cancrop = $conversionUtil.canCrop($catalogid,$result.id,$asset.id))
			#if(!$cancrop)
				#if( $mediaarchive.isCatalogSettingTrue("preventupscaling"))
					#set($show = false)
				#else
				
					#set($show = true)
				#end
			#else
				#set($show = true)
			#end
			
			#if($presetdata.outputextension != "jpg")
				#set($show = false)
			#end
		
			#if($conversionUtil.doesExist($catalogid, $asset.id,$asset.sourcePath, $result.id) && $show)
				
				#if($currentpreset == $result.id)
					#set($current = $result)
				#end
				#set($dimension = $conversionUtil.getConvertPresetDimension($catalogid,$result.id))
				#set($height = $mathtool.toInteger($dimension.getHeight()))
				#set($width = $mathtool.toInteger($dimension.getWidth()))
				
				#set($aspectratio = $conversionUtil.getConvertPresetAspectRatio($dimension))
				#set($description = $conversionUtil.getConvertPresetParameter($catalogid,$result.id, "imagelocation"))
				
				#set($mediaurl = "$home/$mediadbappid/services/module/asset/downloads/preset/#uuencode($asset.sourcepath)/#uuencode($result.generatedoutputfile)")
				
				<div class="mediapreset #if($result.id==$result.id) mediapresetselected #end">
					
					<div class="mediapreset-name" title="$result.name" >$result.name</div>
					<div class="mediapreset-image">
						<a href="$home$apphome/components/asseteditor/preview.html?previewimg=$mediaurl"
							class="emdialog" data-cancelsubmit="true" data-hidefooter="true" data-noesc="true"
							title="$!result.name">
							<img src="$mediaurl?_=$mathutil.getRandomValue(9999)" alt="$result.name" />
						</a>
					</div>
					<div class="mediapreset-actions">
					##Download
					<a class="btn btn-xs btn-primary" 
					    href="$cdnprefix$home/$mediadbappid/services/module/asset/downloads/generated/#uuencode($asset.sourcepath)/#uuencode($result.generatedoutputfile)/#uuencode($mediaarchive.asExportFileName($asset, $result))?includemetadata=true"
					    title="[[Download]] $result.name"><i class="fas fa-download"></i></a>
					    
					 ##Crop
					 #set($cancrop = $conversionUtil.canCrop($mediaarchive, $catalogid, $result.id, $asset.id)) 
					 #if($caneditasset && $cancrop) 
						<a class="btn btn-xs btn-secondary previewcrop-btn ajax" 
							targetdivinner="asset-editor-container"  
							data-oemaxlevel="1"  
							href="$home$apphome/views/modules/asset/editor/media/croppreview.html?assetid=${asset.id}&presetid=${result.id}"
							title="[[Crop]] $result.name"><i class="fas fa-crop"></i></a> 
					 #end
					 
					 ##Share
					 #if($canembedasset)
						<a class="btn btn-xs btn-primary emdialog" 
					    	href="$home$apphome/views/modules/asset/editor/media/share.html?assetid=${asset.id}&presetid=${result.id}"
					    	data-noesc="true"
					    	data-hidefooter="true"
					    	title="[[Share]] $result.name"><i class="fas fa-share-alt"></i></a>
					 #end
					</div>
				</div>
				
			#end
		
		#end  ##foreach
		<div class="clearfix"></div>
		
		

		</div>

	
			##make it submit for on file selected
			<form id="uploadform" 
						class="ajaxform inline-form" targetdiv="asset-editor-container" name="wizard" method="post" enctype="multipart/form-data" 
						action="$home${apphome}/views/modules/asset/editor/media/customthumb.html">
			##	<span class="btn btn-sm btn-secondary btn-default btn-file">
			##	[[Upload]] 
			##	<input type="file" name="file.0" id="file0-file" onchange='$("#uploadform").submit();'>
			##	</span>
			##	<span id="file0-file-info" style="font-size:90%"></span>
				##[[Replace Image]]:<input type="file" size="50" name="file.0">
				<input type="hidden" name="unzip" value="false" />
				<input type="hidden" name="sourcepath" value="$!context.getRequestParameter('assetid')" />
				<input type="hidden" name="assetid" value="$!context.getRequestParameter('assetid')" />
				<input type="hidden" name="presetid" value="$!context.getRequestParameter('presetid')" />
		</form>




</div>
</div>



