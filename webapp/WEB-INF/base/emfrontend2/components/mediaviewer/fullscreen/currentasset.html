#set( $searcher = $mediaarchive.searcherManager.getSearcher($catalogid, "convertpreset"))
#set( $collectionid = $context.getRequestParameter("collectionid") )
#set( $rendertype = $mediaarchive.getMediaRenderType($asset))
#set( $playertype = $mediaarchive.getMediaPlayerType($asset))
#if( !$playertype )
	No template for $playertype
#end
#set( $cdnprefix = $mediaarchive.getCatalogSettingValue("cdn_prefix") )
$context.putPageValue("cdn",$cdnprefix)
#set( $mediadbappid=$mediaarchive.getMediaDbId())

#set( $index = $dialoghits.indexOfId($asset.id))
#set( $previous = false )
#set( $previous = $dialoghits.previous($index))
#set( $next = false )
#set( $next = $dialoghits.next($index))       
#set( $previewonly = $context.getPageValue("previewonly"))
#if( !$previewonly)
	#set( $previewonly = false)
#end
#set( $ismulti = $asset.id.startsWith("multiedit:"))
#set( $opentab = $userprofile.get("assetopentab"))
#if( !$opentab)
	#if( $canmetadatageneral )
		#set( $opentab = "viewproperties")
	#else
		#set( $opentab = "viewpreview")
	#end
#end
#if( $ismulti )
	#set( $opentab = "viewproperties")
#end

#if($opentab == "viewactions")
 #set( $opentabactions = $userprofile.get("assetopentabactions"))

 #if($opentabactions == "closedcaptions" || $opentabactions == "timeline")
	#if( $rendertype != "video")
		#set( $opentab = "viewproperties")
		#set( $opentabactions = false)
	#end
 #end
#end


$dialoghits.setHitsPerPageHeight($context.getRequestParameter("pageheight"),150)
#set( $hitssessionid = $dialoghits.getSessionId())
<div id="main-media-container">
<div id="main-media-viewer" 
data-opentab="$opentab" 
data-hitssessionid="$hitssessionid" 
data-searchtype="asset" 
data-oemaxlevel="1" 
data-editable="$caneditasset" 
data-assetid="$asset.id" data-next="$!next.getId()" 
data-previous="$!previous.getId()"
data-previouspage="$!dialoghits.idOnPreviousPage()" 
data-nextpage="$!dialoghits.idOnNextPage()" >
	#if( !$mediadbappid)
		<p style="color: white;">[[mediadbappid not defined in datamanager]]</p>
	#end
	
	#if($opentab == "viewpreview")
		##$pages.include("/${mediadbappid}/services/module/asset/players/large2/${type}.html", $context)
		$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewpreview.html",$context)
		
		#if( $next )
			#set( $preloadtype = $mediaarchive.getMediaPlayerType($next))
			#if( $preloadtype == "image")
				#set($tpath = $mediaarchive.asLinkToPreview($next, "image1024x768.jpg"))
				<div style="display:none;"><img src="$tpath" /></div>
			#end
		#end
	#elseif($opentab == "viewproperties")
		$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewproperties.html")
	#elseif($opentab == "viewcollaborate")
		$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewcollaborate.html")
	#elseif($opentab == "multiedit")
		$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/multiedit.html")
	#elseif($opentab == "viewactions")
		#set( $opentabactions = $userprofile.get("assetopentabactions"))
		#if ( $type !='video')
			#if(!$opentabactions || $opentabactions == 'timeline' || $opentabactions == 'closedcaptions')
				##Back to Preview
				#set( $opentab = "viewproperties")
				#set( $opentabactions = "")
				$userprofile.set("assetopentabactions", "")
				$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewproperties.html")
			#else
				$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=$opentabactions")
			#end
		#else
			$pages.include("$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=$opentabactions")
		#end
	#end
	
</div>
<div id="footerbase">
	<div id="footermenu">
		<ul>
			
			<li class="footermenu">
				<div class="goleftclick gotoarrows" id="goleftclick" data-enabled="false"><span class="fas fa-caret-left overlay-nav gocaret"></span></div>	
				<div class="gorightclick gotoarrows" id="gorightclick"  data-enabled="false" ><span class="fas fa-caret-right overlay-nav gocaret"></span></div>	
				
			</li>
			<li  class="footermenu bottomtab #if($opentab == "viewpreview")tabselected#end">	
				<a class="expandmenu assetpreview assettab" 
					data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewpreview.html"
					data-assettab="viewpreview"
					title="[[View $asset]]" >
				<i class="fas fa-expand"></i> [[Viewer]]
				</a>
			 </il>
			 #if( !$previewonly && $canmetadatageneral )
			 <li class="footermenu bottomtab #if($opentab == "viewproperties")tabselected#end">
				<a class="expandmenu assettab" 
					data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewproperties.html" title="[[View Metadata]]"
					data-assettab="viewproperties" >
				<i class="fas fa-info-circle"></i> [[Properties]] 
			
				</a>
			</li>
			#end
				
						$pages.include("$apphome/components/detaileditor/assetdatatables.html",$context)
			
			
			
			#if (!$ismulti)
				#if( !$previewonly )
					#if ($canviewcomments || $canassetannotate)
					 <li class="footermenu bottomtab #if($opentab == "viewcollaborate")tabselected#end">
						<a class="expandmenu assettab" 
							data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewcollaborate.html" title="[[Collaborate]]"
							data-assettab="viewcollaborate" >
						<i class="fas fa-comment-alt"></i> [[Collaborate]] 
						</a>
					</li>
					#end
				#end
			#end
			#if ( $canshareasset && !$ismulti )
            <li class="footermenu bottomtab">
			   <a href="#" class="expandmenu dropdown-toggle" data-toggle="dropdown" title="[[Share]]">
			   	 <span class="fas fa-share-alt"></span> [[Share]]</a>
			   <ul class="dropdown-menu">
   							#if ($canpublish)
	                       <li>
	                           <a  class="dropdown-item  emdialog"  data-hidefooter="true" data-noesc="true"   href="$home$apphome/views/activity/publishassets.html?assetid=$asset.id" >[[Publish]]</a>
	                       </li>
	                       	#end
	                       	#if( $canemaillink )
	                       <li>
	                           <a  class="dropdown-item  emdialog"  data-hidefooter="true" data-noesc="true"   href="$home$apphome/views/activity/emailassets.html?assetid=$asset.id" >[[Email]]</a>
	                       </li>
	                       	#end
	                       	#if( $canembedasset && !$multi)
	                       <li>
	                           <a  class="dropdown-item  emdialog"  data-hidefooter="true" data-noesc="true"   href="$home$apphome/components/share/embed.html?assetid=$asset.id&collectionid=$!collectionid" >[[Embed]]</a>
	                       </li>
	                       	#end
	                       	#if ( $canaddtoproject )
							<li id="add-to-collection">
								<a class="dropdown-item ajax" targetdivinner="shareOptionsContainer" href="#">[[Add to Project]]</a>
							</li>
							#end
             </ul>
             </li>
             #end
    		#set( $originalpath = $mediaarchive.asLinkToOriginal($asset) )	
			#if($candownload && $asset.getFileFormat()  == "pdf")
			<li class="footermenu bottomtab" >
			    <a data-assetid="${asset.id}" target="_new" href="$cdnprefix$home/$mediadbappid/services/module/asset/downloads/vieworiginal/$originalpath" >
	            	<span class="fas fa-file-alt"> </span> [[View PDF]]
	            </a>
            </li> 
			#end
			#if (!$ismulti)
			#if($candownload || $canconvert)
				<li class="footermenu bottomtab" >		
					<a href="#" class="expandmenu dropdown-toggle" data-toggle="dropdown" expanded="true" > <span class="fas fa-download"></span>  [[Download]]</a>
					   <ul class="dropdown-menu">
						#if( !$cdnprefix )
							#set( $cdnprefix = $context.siteRoot )
						#end
								
						 #if($candownload)				
							<li><a href="$cdnprefix$home/$mediadbappid/services/module/asset/downloads/originals/$originalpath">[[Original File]]</a></li>
						#end	
						#if($canconvert)

						#if( $rendertype )
						#set( $searcher = $mediaarchive.searcherManager.getSearcher($catalogid, "convertpreset"))
						#set( $results = $searcher.query().exact("inputtype",$rendertype).sort("ordering").named("convertpresets").search($context) )
						#end
						
							#foreach($result in $results )						
									<li><a href="$cdnprefix$home/$mediadbappid/services/module/asset/downloads/createpreset/${asset.sourcepath}/${result.generatedoutputfile}/${asset.name}-${result.generatedoutputfile}">$result.name</a></li>
							#end
						#end
					</ul>
				  </li>
			 #end
            #end
						
			#if( !$previewonly 	&& !$ismulti)
			<li class="footermenu bottomtab bottomtabactions #if($opentabactions) tabselected #end">
			   <a href="#" class="expandmenu dropdown-toggle" data-toggle="dropdown" title="[[Actions Menu]]"> 
			   <span class="fas fa-edit"></span>
			   <span class="bottomtabactionstext"> 
			   ##TODO Create a table for actions
			   #if ($opentabactions=='conversions')
			   		[[Conversions]]
			   #elseif ($opentabactions=='timeline')
			   		[[Timeline]]
			   #elseif ($opentabactions=='closedcaptions')
			   		[[Closed Captions]]
			   #elseif ($opentabactions=='categorize')
			   		[[Categories]]
			   #elseif ($opentabactions=='map')
			   		[[Map]]
			   #elseif ($opentabactions=='attachments')
			   		[[Attachments]]
			   #elseif ($opentabactions=='converthistory')
			   		[[History]]
			   #else
			   	[[Actions]]
			   #end
			   </span>
			   </a>
			   <ul class="dropdown-menu">

			   
		    	#if( !$ismulti && $canviewconversions )
			   	<li>
			   	<a class="assettab #if($opentabactions=='conversions') dropdown-current #end" 
						data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=conversions" title="[[Conversions]]"
						data-assettab="viewactions"
						data-assettabactions="conversions"
						data-assettabname="[[Conversions]]" >
					[[Conversions]] 
					</a>
			   	</li>
			   	#end
			   	#if(!$ismulti && $rendertype == "video")
			   		#if($canviewtimeline)
			   			<li>
					   	<a class="assettab #if($opentabactions=='timeline') dropdown-current #end" 
								data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=timeline" title="[[Timeline]]"
								data-assettab="viewactions"
								data-assettabactions="timeline"
								data-assettabname="[[Timeline]]" >
							[[Timeline]]
							</a>
					   	</li>
			   		#end
			   		#if($canviewclosedcaptions)
			   			<li>
					   	<a class="assettab #if($opentabactions=='closedcaptions') dropdown-current #end" 
								data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=closedcaptions" title="[[Closed Captions]]"
								data-assettab="viewactions"
								data-assettabactions="closedcaptions"
								data-assettabname="[[Closed Captions]]" >
							[[Closed Captions]]
							</a>
					   	</li>
			   		#end
			   	#end
		    	#if(!$ismulti && $canviewmap)
			   	<li>
			   	<a class="assettab #if($opentabactions=='map') dropdown-current #end" 
						data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=map" title="[[Map]]"
						data-assettab="viewactions"
						data-assettabactions="map"
						data-assettabname="[[Map]]" >
					[[Map]] 
					</a>
			   	</li>
			   	#end
			   	
		    	#if( !$ismulti && $canviewattachments )
			   	<li>
			   	<a class="assettab #if($opentabactions=='attachments') dropdown-current #end" 
						data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=attachments" title="[[Attachments]]"
						data-assettab="viewactions"
						data-assettabactions="attachments"
						data-assettabname="[[Attachments]]" >
					[[Attachments]] 
					</a>
			   	</li>
			   	#end
		    	#if( !$ismulti && $canconverthistory )
			   	<li>
			   		<a class="assettab #if($opentabactions=='converthistory') dropdown-current #end" 
						data-link="$apphome/components/mediaviewer/fullscreen/tabs/viewactions.html?action=converthistory" title="[[History]]"
						data-assettab="viewactions"
						data-assettabactions="converthistory"
						data-assettabname="[[History]]" >
					[[History]] 
					</a>
			   	</li>
			   	#end
		    	#if( $candeleteasset )
                 <li>
					#if ( $ismulti )
						#if($canmultidelete)                 
                     		<a class="emdialog"   href="$home$apphome/components/mediaviewer/fullscreen/delete/index.html?collectionid=$!collectionid&hitssessionid=$!hitssessionid">
	                     [[Delete Selected Assets]]</a>
	                    #end 
                    #else
                     <a class="emdialog"   href="$home$apphome/components/mediaviewer/fullscreen/delete/index.html?assetid=$asset.id&collectionid=$!collectionid&hitssessionid=$!hitssessionid">
	                     [[Delete Asset]]</a>
                     #end
                     </a>
                 </li>
                 #end
                 #if( $canmultiedit )
                 <li>
                 	<a class="assettab" id="multiedittab"
						data-link="$apphome/components/mediaviewer/fullscreen/tabs/multiedit.html?assetid=$asset.id&hitssessionid=$!hitssessionid" title="[[Multiedit]]"
						data-assettab="multiedit">
					[[Multiedit]] 
					</a>
                 </li>
                 #end
				</ul>
		    </li>
		    #end
    
		</ul>
	</div>
</div>
</div>

